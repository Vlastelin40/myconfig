>
  {# Morning Report #}
  {%- macro getReport() -%}
    <p>
      {% if now().strftime('%H')|int < 12 and now().strftime('%H')|int > 6 %}
        Доброе утро.
      {% elif now().strftime('%H')|int >= 12 and now().strftime('%H')|int < 17 %}
        Добрый день.
      {% else %}
        Добрый вечер.
      {% endif %}
      </p>
      <p>
        {% if now().strftime('%M')|int == 0 %}
          Сейчас {{ now().strftime('%H')|int | format(morph='час', as_text=false) }}.
        {% else %}
          Сейчас {{ now().strftime('%H')|int | format(morph='час', as_text=false) }} {{ now().strftime('%M')|int | format(morph='минута', as_text=false) }}.
        {% endif %}
      </p>
      <p>
      {{ [
          'Сегодня ',
          'Если вы не заметили, то сегодня ',
          'Знаете какой сегодня день недели? ',
          'Неожиданно, но сегодня '
      ]|random }}
      {{['Понедельник','Вторник','Среда','Четверг','Пятница','Суббота','Воскресенье'][now()|timestamp_custom("%w",true,0)-1]}}.
      </p>
      <p>
        Текущая температура {{states('sensor.esp32_node_mb_outside')|int(0)}} °C 
      </p>
      <p>
        По прогнозу сегодня {{states('sensor.dark_sky_summary_0d')}}
      </p>

  {%- endmacro -%}


  {# a macro that removes all newline characters, empty spaces, and returns formatted text  #}
    {%- macro cleanup(data) -%}
      {%- for item in data.split("\n")  if item | trim != "" -%}
        {{ item | trim }} {% endfor -%}
  {%- endmacro -%}

  {# a macro to call all macros :)  #}
    {%- macro mother_of_all_macros() -%}
      {{ getReport() }}
    {%- endmacro -%}
    
    {# Call the macro  #}
    {{- cleanup(mother_of_all_macros()) -}}
    
#   <p>
#   {% if is_state('sensor.halloween_countdown','0') %}
#     Happy Halloween!
#   {% endif %}
#   {% if is_state('sensor.christmas_countdown','0') %}
#     Merry Christmas Everyone!
#   {% endif %}
#   {% if is_state('sensor.anniversary_our_wedding','0') %}
#     Happy Anniversary! It been an amazing {{ states.sensor.anniversary_our_wedding.attributes.years }} years!
#   {% endif %}
#   {% if is_state('calendar.holidays_in_united_states', 'on') %}
#     Today is {{states.calendar.holidays_in_united_states.attributes.message}}. 
#   {% endif %}
#   {% if is_state('calendar.anchorage_holidays', 'on') %}
#     And do not forget. Today is also {{states.calendar.anchorage_holidays.attributes.message}}. 
#   {% endif %}
#   {% if states.calendar.birthdays.state == 'on' %}
#     Today is {{ states.calendar.birthdays.attributes.message }}! So Happy Birthday! The confetti cannon is not working otherwise I would shower you in paper garbage that someone else would have to pick up.
#   {% endif %}
#   {%- set event=states.calendar.national_holidays.attributes.message %}
#   {% if 'Day' in event and 'National' in event%}
#     {{ [
#       'And a very special Happy ',
#       'It is also ',
#       'Today is also known as ',
#       'Oh <emphasis>Look</emphasis>. Today is ',
#       'Want to know a fact? Today is ',
#       'Everyday can be a holiday. So today is '
#   ]|random }}
#   {{states.calendar.national_holidays.attributes.message | replace("&"," and ") }}.
#   {%- endif -%}
#   </p>
#   <p>

#     {%- if states.sensor.home_to_zoo.state|round > 50 %}
#       Traffic to the Zoo appears heavy than normnal.
#     {% else %}
#       Traffic to the Zoo is normal.
#     {% endif %}
#     Currently it will take {{states.sensor.home_to_zoo.state|round}} minutes to get to the Zoo.

#     {%- if states.sensor.home_to_summit.state|round > 50 %}
#       Traffic to Summit appears heavy than normnal.
#     {% else %}
#       Traffic to Summit is normal.
#     {% endif %}
#     Currently it will take {{states.sensor.home_to_summit.state|round}} minutes to get to Summit taking {{ states.sensor.home_to_summit.attributes.route }}.
# </p>    