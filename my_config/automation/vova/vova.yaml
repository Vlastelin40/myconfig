# #####################################################################################
#
# VOVA - General
#
# #####################################################################################
# Vova - TV Box Restart
# ##################################
  - alias: vova_tv_box_restart_sunday_9am
    id: vova_tv_box_restart_sunday_9am
    initial_state: true
    trigger:
      - platform: time
        at: "09:00:00"
    condition:
      - condition: time
        weekday:
          - sun
      - condition: state
        entity_id: input_boolean.security_mode
        state: "off"
    action:
      - service: switch.turn_off
        entity_id: switch.0x158d000290a0bc_switch
      - delay: "00:00:05"
      - service: switch.turn_on
        entity_id: switch.0x158d000290a0bc_switch
  
# ##################################
# Vova - Purifier on\off
# ##################################
  - alias: vova_purifier_toggle
    id: vova_purifier_toggle
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: person.sandra
        to:
      # - platform: homeassistant
      #   event: start
      # - platform: event
      #   event_type: automation_reloaded
    condition:
      - condition: template
        value_template: "{{ is_state_attr(this.entity_id, 'current',0) }}"
      - condition: template
        value_template: >
          {% set ignore = ['unknown', 'unavailable', 'none','0'] %}
          {{ trigger.from_state.state not in ignore and
            trigger.to_state.state not in ignore and
            trigger.to_state.state != trigger.from_state.state }}
    action:
      - choose:
          - conditions:
              - condition: state
                entity_id: person.sandra
                state: 'home'
            sequence:
              - service: fan.turn_on
                entity_id: fan.purifier2s, fan.breather_v

          - conditions:
              - condition: not
                conditions:
                  - condition: state
                    entity_id: person.sandra
                    state: 'home'
            sequence:
              - service: fan.turn_off
                entity_id: fan.purifier2s, fan.breather_V
  
# ##################################
# Vova - Purifier Favorite at night
# ##################################
  - alias: vova_purifier_favorite_mode
    id: vova_purifier_favorite_mode
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: fan.purifier2s
        for:
          minutes: 1
    condition:
      - condition: state
        entity_id: fan.purifier2s
        state: 'on'
      - condition: template
        value_template: "{{ is_state_attr(this.entity_id, 'current',0) }}"
      - condition: state
        entity_id: binary_sensor.tod_day
        state: 'off'
      - condition: not
        conditions:
          - condition: state
            entity_id: fan.purifier2s
            attribute: preset_mode
            state: 'Favorite'
    action:
      - service: fan.set_preset_mode
        data:
          entity_id: fan.purifier2s
          preset_mode: Favorite
          
# ##################################
# Vova - Alice Stop\Start
# ##################################
  - alias: vova_alice_stop_start
    id: vova_alice_stop_start
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: event
        event_type: xiaomi_aqara.click
        event_data:
          entity_id: sensor.0x158d0001ef609b_action
          click_type: single
    condition:
      - condition: template
        value_template: "{{ is_state_attr(this.entity_id, 'current',0) }}"
    action:
      - choose:
          - conditions:
              - condition: state
                entity_id: media_player.yandex_v
                state: 'playing'
            sequence:
              - service: media_player.turn_off
                entity_id: media_player.yandex_v
          - conditions:
              - condition: not
                conditions:
                  - condition: state
                    entity_id: media_player.yandex_v
                    state: 'playing'
            sequence:
              - service: media_player.play_media
                entity_id: media_player.yandex_v
                data:
                  media_content_id: Включи ланфрен-ланфра по кругу
                  media_content_type: command