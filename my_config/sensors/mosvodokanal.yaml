  - platform: rest
    resource: http://www.mosvodokanal.ru:10080/webservices/address/qual?code=26
    name: mosvodokanal
    value_template: '{{ value_json.result.dtto }}'
    scan_interval: '12:00:00'
    json_attributes_path: $.result
    json_attributes:
      - params

# 1006 - ph - ph - 6.0-9.0
# 1004 - цветность - град - не более 20
# 1005 - мутность - мг\дм3 - не более 1.5
# 1121 - остаточный хлор - мг\дм3 - не нормируется
# 1002 - запах при 20градС - баллы - не более 2
# 1200 - запах при 60градС - баллы - не более 2
# 1013 - железо общее - мг\дм3 - не более 0.3
# 1053 - общее микробное число - кол в 1мл - не более 50
# 5501 - общие колиморфные бактерии - КОЕ\100мл - отсутствие
# 1050 - термотолерантные колиморфные бактерии - КОЕ\100мл - отсутствие
# 1015 - жесткость общая - °Ж - не более 7
# 1104 - аммоний-ион - мг\дм3 - не более 1.9
# 1012 - нитриты - мг\дм3 - не более 3
# 1011 - нитраты - мг\дм3 - не более 45
# 1037 - фториды - мг\дм3 - не более 1.5
# 1018 - окисляемость перманганатная - мг\дм3 - не более 5
# 1008 - хлориды - мг\дм3 - не более 350

  - platform: template 
    sensors: 
      mosvodokanal_ph: # Кислотность (pH)
        friendly_name: Кислотность (pH)
        unit_of_measurement: pH
        icon_template: mdi:water-check
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1006, 'value': '")[1].split("'")[0] | float }}
        attribute_templates:
          range: "6.0 - 9.0"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1006, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}
      mosvodokanal_dh: # Жёсткость общая
        friendly_name: Жёсткость общая
        unit_of_measurement: °Ж
        icon_template: mdi:water-check
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1015, 'value': '")[1].split("'")[0] | float }}
        attribute_templates:
          range: "Не более 7"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1015, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}            
      mosvodokanal_opacity: # Мутность
        friendly_name: Мутность
        unit_of_measurement: мг/дм3
        icon_template: mdi:opacity
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1005, 'value': '")[1].split("'")[0] | float }}
        attribute_templates:
          range: "Не более 1.5"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1005, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}  
      mosvodokanal_chroma: # Цветность
        friendly_name: Цветность
        unit_of_measurement: град.
        icon_template: mdi:palette
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1004, 'value': '")[1].split("'")[0] | float }}
        attribute_templates:
          range: "Не более 20"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1004, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}  
      mosvodokanal_taste: # Привкус
        friendly_name: Привкус
        unit_of_measurement: ""
        icon_template: mdi:emoticon-tongue-outline
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 5148, 'value': '")[1].split("'")[0] }}
        attribute_templates:
          range: "Не нормируется"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 5148, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}  
      mosvodokanal_chloro: # Остаточный хлор
        friendly_name: Остаточный хлор
        unit_of_measurement: мг/дм3
        icon_template: mdi:flask-outline # flask-outline
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1121, 'value': '")[1].split("'")[0] | float }}
        attribute_templates:
          range: "0.3 - 0.5"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1121, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}  
      mosvodokanal_flavor20: # Запах при 20°C
        friendly_name: Запах при 20°C
        unit_of_measurement: ""
        icon_template: mdi:emoticon-confused-outline
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1000, 'value': '")[1].split("'")[0] }}
        attribute_templates:
          range: "Не нормируется"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1000, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}  
      mosvodokanal_flavor20_level: # Уровень запаха при 20°C
        friendly_name: Уровень запаха при 20°C
        unit_of_measurement: балл
        icon_template: mdi:emoticon-confused
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1002, 'value': '")[1].split("'")[0] | float }}
        attribute_templates:
          range: "Не более 2"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1002, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}  
      mosvodokanal_flavor60: # Запах при 60°C
        friendly_name: Запах при 60°C
        unit_of_measurement: ""
        icon_template: mdi:emoticon-confused-outline
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1001, 'value': '")[1].split("'")[0] }}
        attribute_templates:
          range: "Не нормируется"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1001, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}            
      mosvodokanal_flavor60_level: # Уровень запаха при 60°C
        friendly_name: Уровень запаха при 60°C
        unit_of_measurement: балл
        icon_template: mdi:emoticon-confused
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1200, 'value': '")[1].split("'")[0] | float }}
        attribute_templates:
          range: "Не более 2"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1200, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}       
      mosvodokanal_nitrates: # Нитраты
        friendly_name: Нитраты
        unit_of_measurement: мг/дм3
        icon_template: mdi:flask-outline
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1011, 'value': '")[1].split("'")[0] | float }}
        attribute_templates:
          range: "Не более 45"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1011, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }} 
      mosvodokanal_nitrites: # Нитриты
        friendly_name: Нитриты
        unit_of_measurement: мг/дм3
        icon_template: mdi:flask-outline
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1012, 'value': '")[1].split("'")[0] | float }}
        attribute_templates:
          range: "Не более 3"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1012, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }} 
      mosvodokanal_tcb: # Термотолерантные колиморфные бактерии
        friendly_name: Термотолерантные бактерии
        unit_of_measurement: КОЕ/100мл
        icon_template: mdi:bacteria-outline
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1050, 'value': '")[1].split("'")[0] | float }}
        attribute_templates:
          range: "Отсутствие"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1050, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}  
      mosvodokanal_cb: # Общие колиморфные бактерии
        friendly_name: Общие колиморфные бактерии
        unit_of_measurement: КОЕ/100мл
        icon_template: mdi:bacteria-outline
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 5501, 'value': '")[1].split("'")[0] | float }}
        attribute_templates:
          range: "Отсутствие"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 5501, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}  
      mosvodokanal_tmc: # Общее микробное число
        friendly_name: Общее микробное число
        unit_of_measurement: кол/1мл
        icon_template: mdi:bacteria
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1053, 'value': '")[1].split("'")[0] | float }}
        attribute_templates:
          range: "Не более 50"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1053, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}  
      mosvodokanal_ferrum: # Железо общее
        friendly_name: Железо общее
        unit_of_measurement: мг/дм3
        icon_template: mdi:flask-outline
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1013, 'value': '")[1].split("'")[0] | float }}
        attribute_templates:
          range: "Не более 0.3"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1013, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}     
      mosvodokanal_chlorides: # Хлориды
        friendly_name: Хлориды
        unit_of_measurement: мг/дм3
        icon_template: mdi:flask-outline
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1008, 'value': '")[1].split("'")[0] | float }}
        attribute_templates:
          range: "Не более 350"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1008, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}   
      mosvodokanal_oxidability: # Окисляемость перманганатная
        friendly_name: Окисляемость перманганатная
        unit_of_measurement: мг/дм3
        icon_template: mdi:water-check
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1018, 'value': '")[1].split("'")[0] | float }}
        attribute_templates:
          range: "Не более 5"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1018, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}   
      mosvodokanal_fluorides: # Фториды
        friendly_name: Фториды
        unit_of_measurement: мг/дм3
        icon_template: mdi:flask-outline
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1037, 'value': '")[1].split("'")[0].replace('<','') | float }}
        attribute_templates:
          range: "Не более 1.5"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1037, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}   
      mosvodokanal_ammonium: # Аммоний-ион
        friendly_name: Аммоний-ион
        unit_of_measurement: мг/дм3
        icon_template: mdi:flask-outline
        value_template: >
          {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1104, 'value': '")[1].split("'")[0] | float }}
        attribute_templates:
          range: "Не более 1.9"
          in_range: >
            {{ (state_attr('sensor.mosvodokanal', 'params') | join ).split("'id': 1104, 'value': '")[1].split("'inrange': ")[1].split("}")[0] == '1' }}