# #####################################################################################
#
# MASTER BEDROOM - breather
#
# #####################################################################################
# Master Bedroom- breather auto co2
# ################################## 
  - alias: master_bedroom_breather_auto_co2
    id: master_bedroom_breather_auto_co2
    initial_state: true
    trigger:
      - platform: time_pattern
        minutes: "/3"
    condition:
      - condition: state
        entity_id: switch.breather_auto_mb
        state: "on"
      - condition: or
        conditions:
          - condition: and
            conditions:
              - condition: state
                entity_id: input_boolean.security_mode
                state: 'off'
              - condition: numeric_state
                entity_id: sensor.z19_co2_mb
                above: input_number.co2_high_limit
              - condition: state
                entity_id: binary_sensor.breather_mb
                state: 'off'
              # - condition: state
              #   entity_id: binary_sensor.0x158d000200ad58_contact
              #   state: "off"
          - condition: and
            conditions:
              - condition: numeric_state
                entity_id: sensor.z19_co2_mb
                below: input_number.co2_low_limit
              - condition: state
                entity_id: binary_sensor.breather_mb
                state: "on"
    action:
      - choose:
          - conditions:
              - condition: state
                entity_id: binary_sensor.0x158d000200ad58_contact
                state: 'off'
            sequence:
              - service: button.press
                entity_id: button.digma_ir_mb_breather_pwr
              # - service: notify.telegram
              #   data:
              #     message: "{{breather}} power from auto"
              - condition: numeric_state
                entity_id: sensor.z19_co2_mb
                above: input_number.co2_high_limit
              - condition: state
                entity_id: switch.breather_auto_speed_mb
                state: 'on'
              - service: fan.set_percentage
                entity_id: fan.breather_mb
                data:
                  percentage: "{{states('sensor.breather_set_speed_mb')|int(0) }}"
              

          - conditions:
              - condition: state
                entity_id: binary_sensor.0x158d000200ad58_contact
                state: 'on'
              - condition: state
                entity_id: binary_sensor.breather_mb
                state: 'on'
            sequence:
              - service: button.press
                entity_id: button.digma_ir_mb_breather_pwr